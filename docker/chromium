#!/bin/bash

BASE_CMD="/usr/lib/chromium/chromium2"

# 检查主程序是否存在且可执行
if [ ! -x "$BASE_CMD" ]; then
  echo "错误: $BASE_CMD 不存在或不可执行"
  exit 1
fi

# 使用一个数组来存放固定的参数
# 这样做比用一个长字符串更安全，可以避免参数被意外分割
CMD_ARGS=(
  "--ignore-certificate-errors"
  "--ignore-urlfetcher-cert-requests"
)

# 检查环境变量 PROXY_SERVER 是否已设置且不为空
if [ -n "$PROXY_SERVER" ]; then
  # 如果不为空，则将 --proxy-server 参数添加到数组中
  echo "检测到环境变量 PROXY_SERVER, 值为: $PROXY_SERVER"
  CMD_ARGS+=("--proxy-server=$PROXY_SERVER")
fi

# 打印出将要执行的完整命令
# "${CMD_ARGS[@]}" 会将数组中的每个元素作为一个独立的、带引号的参数展开
echo "即将执行: $BASE_CMD ${CMD_ARGS[@]} $@"

# 执行最终的命令，并将脚本的其余所有参数 ($@) 附加到末尾
exec "$BASE_CMD" "${CMD_ARGS[@]}" "$@"